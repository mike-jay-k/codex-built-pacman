<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Pac-Man</title>
<style>
  body {
    background: #000;
    color: #fff;
    display: flex;
    flex-direction: column;
    align-items: center;
    font-family: Arial, sans-serif;
  }
  #grid {
    display: grid;
    grid-template-columns: repeat(19, 24px);
    grid-template-rows: repeat(21, 24px);
    gap: 2px;
    margin-top: 10px;
  }
  #grid div { width: 24px; height: 24px; box-sizing: border-box; position: relative; }
  .wall { background: #0033cc; }
  .empty { background: #000; }
  .dot::after {
    content:"";
    position:absolute;
    top:50%;left:50%;
    transform:translate(-50%, -50%);
    width:6px;height:6px;
    background:#ffd633;
    border-radius:50%;
  }
  .power::after { width:12px;height:12px; }
  .pacman { background: yellow; border-radius:50%; width:100%; height:100%; }
  .ghost { border-radius:50%; width:100%; height:100%; }
  .scared { background:blue !important; }
  #ui { margin-top:10px; }
</style>
</head>
<body>
<div id="ui">Score: <span id="score">0</span> Lives: <span id="lives">3</span></div>
<div id="grid"></div>
<div id="message"></div>
<script>
const WIDTH = 19;
const HEIGHT = 21;
// build layout: outer walls and dots
const layout = [];
for(let y=0;y<HEIGHT;y++){
  const row=[];
  for(let x=0;x<WIDTH;x++){
    let v=2; // dot
    if(y===0||x===0||y===HEIGHT-1||x===WIDTH-1) v=1; // wall
    row.push(v);
  }
  layout.push(row);
}
// power pellets corners
layout[1][1]=3;
layout[1][WIDTH-2]=3;
layout[HEIGHT-2][1]=3;
layout[HEIGHT-2][WIDTH-2]=3;
// ghost spawn 2x2 in center
const centerY=Math.floor(HEIGHT/2);
const centerX=Math.floor(WIDTH/2);
layout[centerY][centerX]=4;
layout[centerY-1][centerX]=4;
layout[centerY][centerX-1]=4;
layout[centerY-1][centerX-1]=4;

class Maze {
  constructor(layout){
    this.layout=layout;
    this.squares=[];
    this.render();
  }
  render(){
    const grid=document.getElementById('grid');
    grid.innerHTML='';
    this.layout.forEach(row=>{
      row.forEach(cell=>{
        const div=document.createElement('div');
        switch(cell){
          case 1: div.classList.add('wall');break;
          case 2: div.classList.add('dot');break;
          case 3: div.classList.add('dot','power');break;
          case 4: div.classList.add('empty');break;
          default: div.classList.add('empty');
        }
        grid.appendChild(div);
        this.squares.push(div);
      });
    });
  }
  index(x,y){ return y*WIDTH + x; }
  isWall(x,y){ return this.layout[y][x]===1; }
  removeDot(x,y){
    const val=this.layout[y][x];
    if(val===2||val===3){
      this.layout[y][x]=0;
      const sq=this.squares[this.index(x,y)];
      sq.className='empty';
      return val;
    }
    return 0;
  }
}

class Pacman{
  constructor(x,y,maze){
    this.x=x;this.y=y;this.maze=maze;
    this.dir={x:0,y:0};this.nextDir={x:0,y:0};
    this.el=document.createElement('div');
    this.el.className='pacman';
    maze.squares[maze.index(x,y)].appendChild(this.el);
  }
  setDirection(dx,dy){ this.nextDir={x:dx,y:dy}; }
  step(){
    if(this.canMove(this.nextDir)) this.dir=this.nextDir;
    if(this.canMove(this.dir)){
      this.x=(this.x+this.dir.x+WIDTH)%WIDTH;
      this.y=(this.y+this.dir.y+HEIGHT)%HEIGHT;
    }
  }
  canMove(d){
    const nx=(this.x+d.x+WIDTH)%WIDTH;
    const ny=(this.y+d.y+HEIGHT)%HEIGHT;
    return !this.maze.isWall(nx,ny);
  }
  update(){
    this.maze.squares[this.maze.index(this.x,this.y)].appendChild(this.el);
  }
}

class Ghost{
  constructor(name,color,x,y,maze,speed){
    this.name=name;this.color=color;this.x=x;this.y=y;this.maze=maze;this.speed=speed;
    this.isScared=false;
    this.dir={x:1,y:0};
    this.el=document.createElement('div');
    this.el.className='ghost';
    this.el.style.background=color;
    maze.squares[maze.index(x,y)].appendChild(this.el);
  }
  step(){
    const dirs=[{x:-1,y:0},{x:1,y:0},{x:0,y:-1},{x:0,y:1}];
    const allowed=dirs.filter(d=>!this.maze.isWall((this.x+d.x+WIDTH)%WIDTH,(this.y+d.y+HEIGHT)%HEIGHT));
    this.dir=allowed[Math.floor(Math.random()*allowed.length)];
    this.x=(this.x+this.dir.x+WIDTH)%WIDTH;
    this.y=(this.y+this.dir.y+HEIGHT)%HEIGHT;
  }
  update(){
    this.el.classList.toggle('scared',this.isScared);
    this.maze.squares[this.maze.index(this.x,this.y)].appendChild(this.el);
  }
}

class Game{
  constructor(){
    this.maze=new Maze(layout);
    this.score=0;this.lives=3;
    this.pacman=new Pacman(1,HEIGHT-2,this.maze);
    this.ghosts=[
      new Ghost('blinky','red',centerX,centerY,this.maze,10),
      new Ghost('pinky','hotpink',centerX-1,centerY,this.maze,10),
      new Ghost('inky','cyan',centerX,centerY-1,this.maze,10),
      new Ghost('clyde','orange',centerX-1,centerY-1,this.maze,10)
    ];
    document.addEventListener('keydown',e=>this.handleKey(e));
    requestAnimationFrame(()=>this.loop());
  }
  handleKey(e){
    if(e.key==='ArrowLeft') this.pacman.setDirection(-1,0);
    else if(e.key==='ArrowRight') this.pacman.setDirection(1,0);
    else if(e.key==='ArrowUp') this.pacman.setDirection(0,-1);
    else if(e.key==='ArrowDown') this.pacman.setDirection(0,1);
  }
  loop(){
    this.pacman.step();
    const eaten=this.maze.removeDot(this.pacman.x,this.pacman.y);
    if(eaten){
      this.score += (eaten===3?50:10);
      document.getElementById('score').textContent=this.score;
      if(eaten===3){
        this.ghosts.forEach(g=>{g.isScared=true; setTimeout(()=>g.isScared=false,7000);});
      }
    }
    for(const g of this.ghosts){
      g.step();
      if(g.x===this.pacman.x && g.y===this.pacman.y){
        if(g.isScared){
          this.score+=200; document.getElementById('score').textContent=this.score;
          g.x=centerX; g.y=centerY;
        }else{
          this.lives--; document.getElementById('lives').textContent=this.lives;
          if(this.lives===0){
            document.getElementById('message').textContent='Game Over';
            return;
          }
          this.pacman.x=1;this.pacman.y=HEIGHT-2;
        }
      }
      g.update();
    }
    this.pacman.update();
    if(this.maze.layout.flat().every(c=>c!==2 && c!==3)){
      document.getElementById('message').textContent='You Win!';
      return;
    }
    requestAnimationFrame(()=>this.loop());
  }
}

new Game();
</script>
</body>
</html>
